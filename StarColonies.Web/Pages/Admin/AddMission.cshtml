@page
@model StarColonies.Web.Pages.Admin.AddMission

@{
    ViewData["Title"] = "Ajouter une mission";
    Layout = "~/Pages/Shared/_Layout.cshtml";
}

@await Html.PartialAsync("_AdminNavbar")

<div class="container mt-2">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="font-barlow">
            <i class="fas fa-plus me-2"></i>Ajouter une mission
        </h1>
    </div>

    <form method="post" enctype="multipart/form-data" class="shadow-sm rounded p-4 bg-dark">
        <!-- Section Image -->
        <div class="mb-4 text-center">
            <div class="mission-image-preview mb-3" style="width: 200px; height: 200px; margin: 0 auto; background-color: var(--secondary-bg-color); border-radius: 8px; overflow: hidden;">
                <img id="imagePreview" src="#" alt="Aperçu de l'image" style="width: 100%; height: 100%; object-fit: cover; display: none;"/>
            </div>
            <div class="form-group">
                <label for="missionImage" class="btn btn-accent">
                    <i class="fas fa-upload me-2"></i>Choisir une image
                </label>
                <input type="file" class="form-control-file d-none" id="missionImage" asp-for="AddMissionInputModel.MissionImage" accept="image/*" onchange="previewImage(this);" />
                <span asp-validation-for="AddMissionInputModel.MissionImage" class="text-danger small"></span>
            </div>
        </div>

        <!-- Informations de base -->
        <div class="mb-3">
            <label asp-for="AddMissionInputModel.MissionName" class="form-label">Nom de la mission</label>
            <input type="text" class="form-control bg-dark text-white border-secondary" id="missionName" asp-for="AddMissionInputModel.MissionName" required />
            <span asp-validation-for="AddMissionInputModel.MissionName" class="text-danger small"></span>
        </div>

        <div class="mb-3">
            <label asp-for="AddMissionInputModel.MissionDescription" class="form-label">Description</label>
            <textarea class="form-control bg-dark text-white border-secondary" id="missionDescription" asp-for="AddMissionInputModel.MissionDescription" rows="3"></textarea>
            <span asp-validation-for="AddMissionInputModel.MissionDescription" class="text-danger small"></span>
        </div>

        <!-- Sélection du bestiaire -->
        <div class="mb-4">
            <label class="form-label">Bestiaire associé</label>
            <div class="bestiary-selection bg-secondary bg-opacity-10 p-3 rounded">
                @foreach (var bestiaire in Model.AvailableBestiaires)
                {
                    <div class="form-check mb-2">
                        <input class="form-check-input"
                               type="checkbox"
                               name="AddMissionInputModel.SelectedMonsters"
                               id="monster-@bestiaire.Id"
                               value="@bestiaire.Id" />
                        <label class="form-check-label d-flex align-items-center" for="monster-@bestiaire.Id">
                            <img src="~/icons/@bestiaire.TypeBestiaireAvatar" alt="@bestiaire.Name" style="width: 40px; height: 40px; object-fit: cover; border-radius: 50%; margin-right: 10px;">
                            @bestiaire.Name (Endurance @bestiaire.Endurance - Force @bestiaire.Strength)
                        </label>
                    </div>
                }
            </div>
            <span asp-validation-for="AddMissionInputModel.SelectedMonsters" class="text-danger small"></span>
        </div>

        <button type="submit" class="btn btn-accent">
            <i class="fas fa-save me-2"></i>Créer la mission
        </button>
    </form>
</div>

<partial name="Shared/_ValidationScriptsPartial" />

@section Scripts {
    <script>
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            const file = input.files[0];
            const reader = new FileReader();

            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }

            if (file) {
                reader.readAsDataURL(file);
            }
        }
    </script>
}

@section Styles {
    <style>
        .mission-image-preview {
            border: 2px dashed var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .mission-image-preview::before {
            content: "Aperçu de l'image";
            color: var(--text-color);
            opacity: 0.5;
        }

        .mission-image-preview.has-image::before {
            display: none;
        }

        .bestiary-selection {
            max-height: 300px;
            overflow-y: auto;
        }

        .form-check-label {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .form-check-label:hover {
            background-color: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
    </style>
}