@page
@model StarColonies.Web.Pages.RegisterProfession

@{
    ViewData["Title"] = "Inscription - Profession";
    ViewData["HideNavButtons"] = true;
}

<div class="container d-flex flex-column align-items-center py-5">

    <!-- Étapes d'inscription -->
    <div class="registration-steps mb-4">
        <!-- Étape 1 (complétée) -->
        <div class="step-item completed">
            <div class="step-circle">1</div>
            <div class="step-label">Informations</div>
        </div>

        <!-- Ligne de connexion 1-2 -->
        <div class="step-line active-line"></div>

        <!-- Étape 2 (complétée) -->
        <div class="step-item completed">
            <div class="step-circle">2</div>
            <div class="step-label">Avatar</div>
        </div>

        <!-- Ligne de connexion 2-3 -->
        <div class="step-line active-line"></div>

        <!-- Étape 3 (active) -->
        <div class="step-item active">
            <div class="step-glow-wrapper">
                <div class="step-circle">3</div>
            </div>
            <div class="step-label">Profession</div>
        </div>
    </div>

    <!-- Formulaire de sélection de profession -->
    <div class="hall-of-fame w-100" style="max-width: 650px;">
        <h3 class="py-3 mb-0 text-center fw-bold font-barlow login-header">INSCRIPTION</h3>

        <form method="post" class="p-4">
            <!-- Choix de profession -->
            <div class="row g-3 mb-5">
                <!-- Ingénieur -->
                <div class="col-md-3 col-6">
                    <div class="profession-option" data-profession="ingenieur">
                        <div class="profession-card bg-dark rounded text-center p-3 border border-2 border-transparent">
                            <div class="profession-icon d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 60px; height: 60px;">
                                <img src="~/icons/icon_88.png" alt="Potion de force" class="rounded-3" style="width: 50px; height: 50px;"/>
                            </div>
                            <h5 class="font-barlow mb-1">Ingénieur</h5>
                            <p class="small text-muted mb-0">Expert dans la construction et la maintenance technologique</p>
                        </div>
                    </div>
                </div>

                <!-- Médecin -->
                <div class="col-md-3 col-6">
                    <div class="profession-option" data-profession="medecin">
                        <div class="profession-card bg-dark rounded text-center p-3 border border-2 border-transparent">
                            <div class="profession-icon d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 60px; height: 60px;">
                                <img src="~/icons/icon_88.png" alt="Potion de force" class="rounded-3" style="width: 50px; height: 50px;"/>
                            </div>
                            <h5 class="font-barlow mb-1">Médecin</h5>
                            <p class="small text-muted mb-0">Spécialiste des soins et traitements médicaux en espace</p>
                        </div>
                    </div>
                </div>

                <!-- Scientifique -->
                <div class="col-md-3 col-6">
                    <div class="profession-option" data-profession="scientifique">
                        <div class="profession-card bg-dark rounded text-center p-3 border border-2 border-transparent">
                            <div class="profession-icon d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 60px; height: 60px;">
                                <img src="~/icons/icon_88.png" alt="Potion de force" class="rounded-3" style="width: 50px; height: 50px;"/>
                            </div>
                            <h5 class="font-barlow mb-1">Scientifique</h5>
                            <p class="small text-muted mb-0">Expert dans la recherche et les découvertes scientifiques</p>
                        </div>
                    </div>
                </div>

                <!-- Soldat -->
                <div class="col-md-3 col-6">
                    <div class="profession-option" data-profession="soldat">
                        <div class="profession-card bg-dark rounded text-center p-3 border border-2 border-transparent">
                            <div class="profession-icon d-flex align-items-center justify-content-center mx-auto mb-2" style="width: 60px; height: 60px;">
                                <img src="~/icons/icon_88.png" alt="Potion de force" class="rounded-3" style="width: 50px; height: 50px;"/>
                            </div>
                            <h5 class="font-barlow mb-1">Soldat</h5>
                            <p class="small text-muted mb-0">Expert en combat et protection des colonies spatiales</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistiques -->
            <div class="stats-section mb-4">
                <!-- Force -->
                <div class="stat-item d-flex align-items-center mb-3">
                    <label class="me-2 font-barlow fw-bold" asp-for="RegisterProfessionInputModel.Force" style="width: 120px;">FORCE</label>
                    <div class="w-100">
                        <input type="range" class="form-range" asp-for="RegisterProfessionInputModel.Force" id="forceRange" name="Force" min="1" max="6" value="2">
                    </div>
                    <in class="ms-2 stat-value">2</in>
                </div>

                <!-- Endurance -->
                <div class="stat-item d-flex align-items-center">
                    <label class="me-2 font-barlow fw-bold" style="width: 120px;" asp-for="RegisterProfessionInputModel.Endurance">ENDURANCE</label>
                    <div class="w-100">
                        <input type="range" class="form-range" id="enduranceRange" name="Endurance" asp-for="RegisterProfessionInputModel.Endurance" min="1" max="6" value="5">
                    </div>
                    <span class="ms-2 stat-value">5</span>
                </div>
            </div>

            <div class="d-flex justify-content-between mt-5">
                <a href="/RegisterAvatar" class="btn btn-outline-secondary font-barlow fw-bold w-50 mx-3 d-flex align-items-center justify-content-center">
                    <i class="fas fa-arrow-left me-2"></i> PRÉCÉDENT
                </a>
                <button type="submit" class="btn btn-special font-barlow fw-bold w-50 mx-3">COMMENCER L'AVENTURE</button>
            </div>

            <input type="hidden" id="selectedProfession" name="SelectedProfession" value="" />
        </form>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const professionOptions = document.querySelectorAll('.profession-option');
            const selectedProfessionInput = document.getElementById('selectedProfession');
            const forceRange = document.getElementById('forceRange');
            const enduranceRange = document.getElementById('enduranceRange');
            const forceValue = document.querySelector('.stat-item:nth-child(1) .stat-value');
            const enduranceValue = document.querySelector('.stat-item:nth-child(2) .stat-value');

            // Définir la somme totale qui doit être maintenue
            const totalPoints = 7;

            // Événement de clic pour les options de profession
            professionOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Supprimer la classe 'selected' de toutes les options
                    professionOptions.forEach(opt => opt.querySelector('.profession-card').classList.remove('selected'));

                    // Ajouter la classe 'selected' à l'option cliquée
                    this.querySelector('.profession-card').classList.add('selected');

                    // Stocker la profession sélectionnée
                    const professionId = this.getAttribute('data-profession');
                    selectedProfessionInput.value = professionId;
                });
            });

            // Mise à jour des valeurs d'attributs lors du déplacement des curseurs
            forceRange.addEventListener('input', function() {
                const forceVal = parseInt(this.value);
                forceValue.textContent = forceVal;

                // Calculer et définir la valeur d'endurance pour maintenir la somme à 7
                const newEndurance = totalPoints - forceVal;
                if (newEndurance >= 1 && newEndurance <= 6) {
                    enduranceRange.value = newEndurance;
                    enduranceValue.textContent = newEndurance;
                }
            });

            enduranceRange.addEventListener('input', function() {
                const enduranceVal = parseInt(this.value);
                enduranceValue.textContent = enduranceVal;

                // Calculer et définir la valeur de force pour maintenir la somme à 7
                const newForce = totalPoints - enduranceVal;
                if (newForce >= 1 && newForce <= 6) {
                    forceRange.value = newForce;
                    forceValue.textContent = newForce;
                }
            });

            // Initialiser les valeurs pour avoir une somme de 7
            const initialForce = 2;
            const initialEndurance = 5;
            forceRange.value = initialForce;
            enduranceRange.value = initialEndurance;
            forceValue.textContent = initialForce;
            enduranceValue.textContent = initialEndurance;

            // Sélectionner la première profession par défaut
            professionOptions[0].click();
        });
    </script>
}

@section Styles {
    <style>
        /* Styles pour les étapes d'inscription avec effet de halo */
        .registration-steps {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
            max-width: 500px;
        }

        .step-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2;
        }

        .step-glow-wrapper {
            position: relative;
            margin-bottom: 8px;
        }

        .step-item.active .step-glow-wrapper::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 5rem;
            height: 5rem;
            background: radial-gradient(
                circle,
                rgba(59, 130, 246, 0.6) 0%,
                rgba(59, 130, 246, 0.3) 20%,
                rgba(59, 130, 246, 0.1) 40%,
                rgba(59, 130, 246, 0) 70%
            );
            z-index: -1;
            border-radius: 50%;
            filter: blur(10px);
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #25192f;
            color: #a0a0a0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .step-item.active .step-circle {
            background-color: var(--accent-color);
            color: white;
        }

        .step-item.completed .step-circle {
            border: solid 0.1rem var(--accent-color);
            color: white;
        }

        .step-label {
            font-size: 0.85rem;
            color: #a0a0a0;
            text-align: center;
        }

        .step-item.active .step-label,
        .step-item.completed .step-label {
            color: white;
        }

        .step-line {
            height: 2px;
            background-color: transparent;
            width: 100%;
            max-width: 120px;
            margin: 0 5px;
            position: relative;
            top: -20px;
            z-index: 1;
        }
        

        /* Styles pour la sélection de profession */
        .profession-option {
            cursor: pointer;
            height: 15rem;
        }

        .profession-card {
            transition: all 0.2s ease;
            height: 100%;
            min-height: 215px; /* Fixer une hauteur minimale pour que toutes les cartes aient la même taille */
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .profession-option:hover .profession-card {
            transform: translateY(-5px);
        }

        .profession-card.selected {
            border-color: var(--accent-color) !important;
            background-color: var(--quaternary-bg-color) !important;
        }

        /* Styles pour les curseurs */
        .form-range {
            height: 8px;
        }

        .form-range::-webkit-slider-thumb {
            background-color: var(--accent-color);
        }

        .form-range::-moz-range-thumb {
            background-color: var(--accent-color);
        }

        .stat-value {
            width: 30px;
            text-align: center;
            font-weight: bold;
        }
        
    </style>
}